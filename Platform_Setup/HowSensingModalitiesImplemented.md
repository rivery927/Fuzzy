å¥½çš„ï¼Œè®©æˆ‘åŸºäºæˆ‘ä»¬çš„å®é™…äº’åŠ¨ï¼Œä¸ºä½ å…¨é¢å¤ç›˜å¯¼å¸ˆçš„é—®é¢˜ã€‚

---

# å…¨é¢å¤ç›˜ï¼šHow Different Sensing Modalities Are Implemented

## åŸºäº rivery å·¥ä½œç«™çš„å®é™…éªŒè¯

**è®¾å¤‡**: Alienware 16 Area-51 (RTX 5080)  
**ç³»ç»Ÿé…ç½®**: Ubuntu 24.04 + Isaac Sim 5.1.0 + PX4 v1.15.4 + Pegasus 5.1.0  
**éªŒè¯æ—¥æœŸ**: 2026å¹´1æœˆ19-20æ—¥

---

# ç¬¬ä¸€éƒ¨åˆ†ï¼šç³»ç»Ÿæ¶æ„æ€»è§ˆ

## 1.1 ä¼ æ„Ÿå™¨åˆ†ç±»

åœ¨æˆ‘ä»¬çš„ä»¿çœŸå¹³å°ä¸­ï¼Œä¼ æ„Ÿå™¨åˆ†ä¸ºä¸¤å¤§ç±»ï¼š

| ç±»åˆ« | ä¼ æ„Ÿå™¨ | ç”¨é€” | å®ç°ä½ç½® |
|------|--------|------|----------|
| **å¯¼èˆªä¼ æ„Ÿå™¨** | IMU, GPS, æ°”å‹è®¡, ç£åŠ›è®¡ | å‘Šè¯‰æ— äººæœº"æˆ‘åœ¨å“ª" | Pegasus å†…ç½® |
| **æ„ŸçŸ¥ä¼ æ„Ÿå™¨** | ç›¸æœº, LiDAR | å‘Šè¯‰æ— äººæœº"å‘¨å›´æœ‰ä»€ä¹ˆ" | Isaac Sim RTX |

## 1.2 æ•°æ®æµæ¶æ„ï¼ˆåŸºäºå®é™…éªŒè¯ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®é™…éªŒè¯çš„ç³»ç»Ÿæ¶æ„                                     â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Isaac Sim 5.1.0 æ¸²æŸ“å¼•æ“                          â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   PhysX 5 ç‰©ç†å¼•æ“  â†â†’  RTX å…‰çº¿è¿½è¸ªæ¸²æŸ“                             â”‚   â”‚
â”‚  â”‚         â”‚                      â”‚                                    â”‚   â”‚
â”‚  â”‚         â–¼                      â–¼                                    â”‚   â”‚
â”‚  â”‚   ç‰©ç†çŠ¶æ€è®¡ç®—            ä¼ æ„Ÿå™¨æ•°æ®ç”Ÿæˆ                              â”‚   â”‚
â”‚  â”‚   (ä½ç½®/é€Ÿåº¦/å§¿æ€)        (å›¾åƒ/ç‚¹äº‘)                                â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                        â”‚                                       â”‚
â”‚            â–¼                        â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Pegasus å¯¼èˆªä¼ æ„Ÿå™¨â”‚      â”‚      Isaac Sim æ„ŸçŸ¥ä¼ æ„Ÿå™¨ API            â”‚   â”‚
â”‚  â”‚                  â”‚      â”‚                                          â”‚   â”‚
â”‚  â”‚ â€¢ IMU æ¨¡å‹       â”‚      â”‚  isaacsim.sensors.camera.Camera          â”‚   â”‚
â”‚  â”‚ â€¢ GPS æ¨¡å‹       â”‚      â”‚    â””â”€â”€ get_rgb_image()    â† æˆ‘ä»¬éªŒè¯è¿‡    â”‚   â”‚
â”‚  â”‚ â€¢ æ°”å‹è®¡æ¨¡å‹     â”‚      â”‚    â””â”€â”€ get_depth_image()                  â”‚   â”‚
â”‚  â”‚ â€¢ ç£åŠ›è®¡æ¨¡å‹     â”‚      â”‚                                          â”‚   â”‚
â”‚  â”‚                  â”‚      â”‚  IsaacSensorCreateRtxLidar               â”‚   â”‚
â”‚  â”‚  â†“ MAVLink       â”‚      â”‚    â””â”€â”€ annotator.get_data() â† æˆ‘ä»¬éªŒè¯è¿‡  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                                                 â”‚
â”‚           â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      PX4 v1.15.4 SITL                                â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   HIL_SENSOR/HIL_GPS  â†’  EKF2 çŠ¶æ€ä¼°è®¡  â†’  çº§è”æ§åˆ¶å™¨  â†’  ç”µæœºæŒ‡ä»¤   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# ç¬¬äºŒéƒ¨åˆ†ï¼šç›¸æœºï¼ˆCameraï¼‰å®ç°è¯¦è§£

## 2.1 æºç åˆ†æ

æˆ‘ä»¬å®é™…æŸ¥çœ‹äº† Pegasus çš„ç›¸æœºå®ç°æºç ï¼š

**æ–‡ä»¶è·¯å¾„**ï¼š`~/PegasusSimulator/extensions/pegasus.simulator/pegasus/simulator/logic/graphical_sensors/monocular_camera.py`

**å…³é”®å‘ç°**ï¼ˆä»æºç ä¸­æå–ï¼‰ï¼š

```python
# ç¬¬14è¡Œï¼šä½¿ç”¨ Isaac Sim å†…ç½®çš„ Camera ç±»
from isaacsim.sensors.camera.camera import Camera

# ç¬¬93-96è¡Œï¼šåˆ›å»ºç›¸æœºå®ä¾‹
self._camera = Camera(
    prim_path=self._stage_prim_path,
    frequency=self._frequency,
    resolution=self._resolution
)

# ç¬¬155è¡Œï¼ˆæ³¨é‡Šä¸­è¯´æ˜ï¼‰ï¼šè·å–å›¾åƒçš„æ–¹æ³•
# self._state["camera"].get_rgb_image()  # For RGB image
# self._state["camera"].get_depth_image()  # For Depth image
```

## 2.2 ç›¸æœºé…ç½®å‚æ•°

æˆ‘ä»¬åœ¨ `sensor_test.py` å’Œ `test_camera_data.py` ä¸­ä½¿ç”¨çš„é…ç½®ï¼š

```python
front_camera = MonocularCamera("front_camera", config={
    "frequency": 30.0,              # é‡‡æ ·ç‡ï¼š30 Hz
    "resolution": (640, 480),       # åˆ†è¾¨ç‡ï¼šVGA
    "position": np.array([0.15, 0.0, 0.0]),  # ä½ç½®ï¼šæ— äººæœºå‰æ–¹ 15cm
    "orientation": np.array([0.0, 0.0, 0.0]), # æœå‘ï¼šæ­£å‰æ–¹
    "depth": True,                  # å¯ç”¨æ·±åº¦å›¾
})
```

## 2.3 å®é™…éªŒè¯ç»“æœ

**è¿è¡Œçš„è„šæœ¬**ï¼š`~/test_camera_data.py`

**ç»ˆç«¯è¾“å‡º**ï¼š
```
âœ… è·å–åˆ°å›¾åƒ! å°ºå¯¸: (480, 640, 3)
ğŸ“· å›¾åƒå·²ä¿å­˜åˆ° ~/camera_test.png
```

**è·å–åˆ°çš„å›¾åƒ**ï¼š
- åˆ†è¾¨ç‡ï¼š640Ã—480 åƒç´ 
- é€šé“æ•°ï¼š3ï¼ˆRGBï¼‰
- å†…å®¹ï¼šæˆåŠŸæ‹æ‘„åˆ°åœºæ™¯ä¸­çš„çº¢è‰²æ–¹å—éšœç¢ç‰©

## 2.4 ç›¸æœºå®ç°åŸç†æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç›¸æœºä¼ æ„Ÿå™¨å®ç°åŸç†                            â”‚
â”‚                                                                 â”‚
â”‚  Isaac Sim RTX æ¸²æŸ“å¼•æ“                                         â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ å…‰çº¿è¿½è¸ªæ¸²æŸ“                                          â”‚
â”‚         â–¼                                                       â”‚
â”‚  isaacsim.sensors.camera.Camera ç±»                              â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”œâ”€â”€ get_rgb()         â†’ RGB å›¾åƒ (H, W, 3) uint8        â”‚
â”‚         â”œâ”€â”€ get_depth()       â†’ æ·±åº¦å›¾ (H, W) float32           â”‚
â”‚         â””â”€â”€ get_pointcloud()  â†’ ç‚¹äº‘ (å¯é€‰)                     â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  Pegasus MonocularCamera å°è£…å±‚                                 â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ self._state["camera"]                                 â”‚
â”‚         â–¼                                                       â”‚
â”‚  ç”¨æˆ·ä»£ç è·å–: state["camera"].get_rgb()                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# ç¬¬ä¸‰éƒ¨åˆ†ï¼šLiDAR å®ç°è¯¦è§£

## 3.1 æºç åˆ†æ

æˆ‘ä»¬å®é™…æŸ¥çœ‹äº† Pegasus çš„ LiDAR å®ç°æºç ï¼š

**æ–‡ä»¶è·¯å¾„**ï¼š`~/PegasusSimulator/extensions/pegasus.simulator/pegasus/simulator/logic/graphical_sensors/lidar.py`

**å…³é”®å‘ç°**ï¼ˆä»æºç ä¸­æå–ï¼‰ï¼š

```python
# ç¬¬66-72è¡Œï¼šåˆ›å»º RTX LiDAR
_, self._sensor = omni.kit.commands.execute(
    "IsaacSensorCreateRtxLidar",      # Isaac Sim çš„ RTX LiDAR å‘½ä»¤
    path=self._lidar_name,
    parent=self._vehicle.prim_path + "/body",
    config=self._sensor_configuration["sensor_configuration"],  # é…ç½®æ–‡ä»¶
    translation=(self._position[0], self._position[1], self._position[2]),
    orientation=Gf.Quatd(...)
)

# ç¬¬76-80è¡Œï¼šå¦‚æœå¯ç”¨æ¸²æŸ“ï¼Œå¯ä»¥å‘å¸ƒåˆ° ROS2
if self._show_render:
    hydra_texture = rep.create.render_product(self._sensor.GetPath(), [1, 1], name="Isaac")
    writer = rep.writers.get("RtxLidar" + "ROS2PublishPointCloud")
    writer.initialize(topicName="point_cloud", frameId="base_scan")
    writer.attach([hydra_texture])
```

**é‡è¦å‘ç°**ï¼šPegasus çš„ `Lidar` ç±»çš„ `update()` æ–¹æ³•**åªè¿”å›åç§°å’Œè·¯å¾„**ï¼Œæ²¡æœ‰å®é™…è·å–ç‚¹äº‘æ•°æ®ï¼š

```python
def update(self, state: State, dt: float):
    # åªè¿”å› prim path å’Œåç§°ï¼Œæ²¡æœ‰ç‚¹äº‘æ•°æ®ï¼
    self._state = {"lidar_name": self._lidar_name, "stage_prim_path": self._stage_prim_path}
    return self._state
```

## 3.2 å¯ç”¨çš„ LiDAR é…ç½®

æˆ‘ä»¬å®é™…è¿è¡Œçš„å‘½ä»¤ï¼š
```bash
ls ~/isaacsim/exts/isaacsim.sensors.rtx/data/lidar_configs/
```

**è¾“å‡ºç»“æœ**ï¼š
```
HESAI  NVIDIA  Ouster  README.md  SICK  SLAMTEC  Velodyne  ZVISION
```

è¿›ä¸€æ­¥æŸ¥çœ‹ï¼š
```bash
ls ~/isaacsim/exts/isaacsim.sensors.rtx/data/lidar_configs/Ouster/
# è¾“å‡ºï¼šOS0  OS1  OS2

ls ~/isaacsim/exts/isaacsim.sensors.rtx/data/lidar_configs/NVIDIA/
# è¾“å‡ºï¼šDebug_Rotary.json  Simple_Example_Solid_State.json
```

**æ”¯æŒçš„ LiDAR å“ç‰Œå’Œå‹å·**ï¼š

| å“ç‰Œ | å¯ç”¨å‹å· | è¯´æ˜ |
|------|----------|------|
| **Ouster** | OS0, OS1, OS2 | å¸¸ç”¨çš„ç ”ç©¶çº§ LiDAR |
| **Velodyne** | (å¤šç§é…ç½®) | ç»å…¸è‡ªåŠ¨é©¾é©¶ LiDAR |
| **HESAI** | (å¤šç§é…ç½®) | å›½äº§é«˜æ€§èƒ½ LiDAR |
| **SICK** | (å¤šç§é…ç½®) | å·¥ä¸šçº§ LiDAR |
| **SLAMTEC** | (å¤šç§é…ç½®) | ä½æˆæœ¬ SLAM LiDAR |
| **ZVISION** | (å¤šç§é…ç½®) | å›ºæ€ LiDAR |
| **NVIDIA** | Debug_Rotary, Simple_Example_Solid_State | ç¤ºä¾‹é…ç½® |

## 3.3 é‡åˆ°çš„é—®é¢˜ä¸è§£å†³

### é—®é¢˜ï¼šAnnotator åç§°é”™è¯¯

**æˆ‘æœ€åˆä½¿ç”¨çš„ä»£ç **ï¼š
```python
self.pc_annotator = rep.AnnotatorRegistry.get_annotator(
    "RtxSensorCpuIsaacCreateRTXLidarScanBuffer"  # âŒ é”™è¯¯çš„åç§°
)
```

**æŠ¥é”™ä¿¡æ¯**ï¼š
```
omni.replicator.core.scripts.annotators.AnnotatorRegistryError: 
No annotator of name RtxSensorCpuIsaacCreateRTXLidarScanBuffer registered. 
Available annotators: ['camera_params', 'rgb', 'normals', ... 
'IsaacExtractRTXSensorPointCloudNoAccumulator', 'IsaacCreateRTXLidarScanBuffer', ...]
```

**è§£å†³æ–¹æ³•**ï¼šä»é”™è¯¯ä¿¡æ¯ä¸­æ‰¾åˆ°äº†æ­£ç¡®çš„ annotator åç§°ï¼š

```python
self.pc_annotator = rep.AnnotatorRegistry.get_annotator(
    "IsaacExtractRTXSensorPointCloudNoAccumulator"  # âœ… æ­£ç¡®çš„åç§°
)
```

**æ•™è®­**ï¼šIsaac Sim ä¸åŒç‰ˆæœ¬çš„ API åç§°å¯èƒ½ä¸åŒï¼Œ5.1.0 ç‰ˆæœ¬ä½¿ç”¨ `IsaacExtractRTXSensorPointCloudNoAccumulator`ã€‚

## 3.4 æœ€ç»ˆæˆåŠŸçš„ LiDAR é…ç½®ä»£ç 

```python
# 1. åˆ›å»º RTX LiDAR ä¼ æ„Ÿå™¨
result, self.lidar_prim = omni.kit.commands.execute(
    "IsaacSensorCreateRtxLidar",
    path="/World/quadrotor/body/lidar",
    parent="/World/quadrotor/body",
    config="Example_Rotary",           # ä½¿ç”¨ç¤ºä¾‹æ—‹è½¬å¼é…ç½®
    translation=(0.0, 0.0, 0.05),      # æ— äººæœºé¡¶éƒ¨ 5cm
    orientation=Gf.Quatd(1.0, 0.0, 0.0, 0.0)
)

# 2. åˆ›å»º Render Product
self.render_product = rep.create.render_product(
    self.lidar_prim.GetPath(), [1, 1], name="LidarRP"
)

# 3. åˆ›å»º Annotator è·å–ç‚¹äº‘æ•°æ®ï¼ˆIsaac Sim 5.1.0 æ­£ç¡®çš„åç§°ï¼‰
self.pc_annotator = rep.AnnotatorRegistry.get_annotator(
    "IsaacExtractRTXSensorPointCloudNoAccumulator"
)
self.pc_annotator.attach([self.render_product])

# 4. è·å–ç‚¹äº‘æ•°æ®
data = self.pc_annotator.get_data()
points = np.array(data["data"]).reshape(-1, 3)  # Nx3 æ ¼å¼
```

## 3.5 å®é™…éªŒè¯ç»“æœ

**è¿è¡Œçš„è„šæœ¬**ï¼š`~/test_lidar_data.py`

**ç»ˆç«¯è¾“å‡º**ï¼š
```
âœ… RTX LiDAR åˆ›å»ºå®Œæˆ
âœ… ç‚¹äº‘è·å–å™¨é…ç½®å®Œæˆ
INFO  [commander] Ready for takeoff!
âœ… è·å–åˆ°ç‚¹äº‘! ç‚¹æ•°: 39960
   X: [-19.08, 19.18] m
   Y: [-29.54, -0.85] m
   Z: [-0.71, 6.21] m
ğŸ“ ç‚¹äº‘å·²ä¿å­˜: /home/rivery/lidar_0.npy (ç‚¹æ•°: 39960)
ğŸ“· ä¿¯è§†å›¾å·²ä¿å­˜: /home/rivery/lidar_0_top.png
```

**ç‚¹äº‘æ•°æ®ç»Ÿè®¡**ï¼š

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| ç‚¹æ•° | ~40,000 | æ¯å¸§çº¦4ä¸‡ä¸ªç‚¹ |
| X èŒƒå›´ | [-19.08, 19.18] m | å·¦å³æ–¹å‘çº¦38ç±³ |
| Y èŒƒå›´ | [-29.54, -0.85] m | å‰æ–¹çº¦29ç±³ |
| Z èŒƒå›´ | [-0.71, 6.21] m | é«˜åº¦çº¦7ç±³ |

**ä¿¯è§†å›¾åˆ†æ**ï¼ˆåŸºäºæˆ‘ä»¬è·å–çš„ `lidar_0_top.png`ï¼‰ï¼š
- é¡¶éƒ¨å¯†é›†çº¿ï¼šç¯å¢ƒå¢™å£ï¼ˆCurved Gridroom çš„è¾¹ç•Œï¼‰
- å¼§å½¢æ‰«æçº¿ï¼šLiDAR ä¸åŒä»°è§’çš„æ‰«æåœˆ
- åº•éƒ¨æ”¾å°„çº¿ï¼šåœ°é¢åå°„
- è¿™æ˜¯å…¸å‹çš„æ—‹è½¬å¼ LiDAR æ‰«ææ¨¡å¼

## 3.6 LiDAR å®ç°åŸç†æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LiDAR ä¼ æ„Ÿå™¨å®ç°åŸç†                          â”‚
â”‚                                                                 â”‚
â”‚  Isaac Sim RTX æ¸²æŸ“å¼•æ“                                         â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ å…‰çº¿è¿½è¸ªæ¨¡æ‹Ÿæ¿€å…‰å‘å°„/æ¥æ”¶                              â”‚
â”‚         â–¼                                                       â”‚
â”‚  IsaacSensorCreateRtxLidar å‘½ä»¤                                 â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ config å‚æ•°æŒ‡å®š LiDAR å‹å·                            â”‚
â”‚         â”‚ (Example_Rotary, OS1_REV6_128ch, ç­‰)                  â”‚
â”‚         â–¼                                                       â”‚
â”‚  rep.create.render_product()                                    â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ åˆ›å»ºæ¸²æŸ“äº§å“                                          â”‚
â”‚         â–¼                                                       â”‚
â”‚  rep.AnnotatorRegistry.get_annotator(                           â”‚
â”‚      "IsaacExtractRTXSensorPointCloudNoAccumulator"             â”‚
â”‚  )                                                              â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ annotator.get_data()                                  â”‚
â”‚         â–¼                                                       â”‚
â”‚  ç‚¹äº‘æ•°æ®: numpy array (N, 3) - [x, y, z]                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# ç¬¬å››éƒ¨åˆ†ï¼šå¯¼èˆªä¼ æ„Ÿå™¨å®ç°ï¼ˆåŸºäºæ–‡æ¡£ï¼‰

## 4.1 å®ç°ä½ç½®

**æ–‡ä»¶è·¯å¾„**ï¼š`~/PegasusSimulator/extensions/pegasus.simulator/pegasus/simulator/logic/sensors/`

åŒ…å«ï¼š
- `imu.py` - IMU ä¼ æ„Ÿå™¨
- `gps.py` - GPS ä¼ æ„Ÿå™¨
- `barometer.py` - æ°”å‹è®¡
- `magnetometer.py` - ç£åŠ›è®¡

## 4.2 æ•°æ®æµ

```
Isaac Sim ç‰©ç†çŠ¶æ€ï¼ˆçœŸå®å€¼ï¼‰
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Pegasus å¯¼èˆªä¼ æ„Ÿå™¨æ¨¡å‹          â”‚
â”‚                                     â”‚
â”‚  çœŸå®å€¼ + åç½®(bias) + å™ªå£°(noise)  â”‚
â”‚         â”‚                           â”‚
â”‚         â–¼                           â”‚
â”‚      ä¼ æ„Ÿå™¨è¾“å‡º                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ MAVLink HIL_SENSOR / HIL_GPS
         â–¼
      PX4 SITL
```

## 4.3 ä¸ PX4 çš„é€šä¿¡

**å…³é”®æ–‡ä»¶**ï¼š`~/PegasusSimulator/extensions/pegasus.simulator/pegasus/simulator/logic/backends/px4_mavlink_backend.py`

è¿™æ˜¯ Pegasus ä¸ PX4 ä¹‹é—´çš„æ¡¥æ¢ï¼Œè´Ÿè´£ï¼š
1. å°†å¯¼èˆªä¼ æ„Ÿå™¨æ•°æ®å°è£…ä¸º MAVLink æ¶ˆæ¯ï¼ˆHIL_SENSOR, HIL_GPSï¼‰
2. é€šè¿‡ TCP ç«¯å£ 4560 å‘é€ç»™ PX4 SITL
3. æ¥æ”¶ PX4 çš„ç”µæœºæ§åˆ¶æŒ‡ä»¤ï¼ˆHIL_ACTUATOR_CONTROLSï¼‰

---

# ç¬¬äº”éƒ¨åˆ†ï¼šROS2 é›†æˆé—®é¢˜

## 5.1 é‡åˆ°çš„é—®é¢˜

æˆ‘ä»¬è¿è¡Œ `ros2 topic list` æ—¶ï¼š

**å‘½ä»¤**ï¼š
```bash
ros2 topic list
```

**è¾“å‡º**ï¼š
```
/parameter_events
/rosout
```

**é—®é¢˜**ï¼šæ²¡æœ‰çœ‹åˆ°ä»»ä½•ä¼ æ„Ÿå™¨æ•°æ®è¯é¢˜ï¼

## 5.2 åŸå› åˆ†æ

| ç»„ä»¶ | Python ç‰ˆæœ¬ |
|------|-------------|
| Isaac Sim 5.1.0 | Python 3.11 |
| ROS2 JAZZY | Python 3.12 |

ç”±äº Python ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œ`sensor_test.py` **æ•…æ„ä¸ä½¿ç”¨ ROS2**ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯ã€‚

**ä»æ–‡æ¡£ä¸­çš„è¯´æ˜**ï¼š
> "sensor_test.py æ•…æ„æ²¡æœ‰ä½¿ç”¨ ROS2ï¼Œå› ä¸ºå­˜åœ¨ Python ç‰ˆæœ¬å†²çª"

## 5.3 è§£å†³æ–¹æ¡ˆ

1. **æ–¹æ¡ˆä¸€ï¼ˆæˆ‘ä»¬ä½¿ç”¨çš„ï¼‰**ï¼šç›´æ¥é€šè¿‡ Isaac Sim Python API è·å–æ•°æ®ï¼Œä¸ä¾èµ– ROS2
2. **æ–¹æ¡ˆäºŒ**ï¼šä½¿ç”¨ Isaac Sim å†…ç½®çš„ OmniGraph ROS2 èŠ‚ç‚¹
3. **æ–¹æ¡ˆä¸‰**ï¼šä»ç‹¬ç«‹çš„ Python 3.12 ç¯å¢ƒè¿è¡Œ ROS2 ä»£ç 

---

# ç¬¬å…­éƒ¨åˆ†ï¼šä¸¤ç±»ä¼ æ„Ÿå™¨å¯¹æ¯”æ€»ç»“

## 6.1 å®ç°æ–¹å¼å¯¹æ¯”

| ç‰¹æ€§ | ç›¸æœº | LiDAR |
|------|------|-------|
| **Isaac Sim åº•å±‚** | `isaacsim.sensors.camera.Camera` | `IsaacSensorCreateRtxLidar` |
| **ç‰©ç†åŸç†** | RTX å…‰çº¿è¿½è¸ªæ¸²æŸ“å›¾åƒ | RTX å…‰çº¿è¿½è¸ªæ¨¡æ‹Ÿæ¿€å…‰ |
| **Pegasus å°è£…** | `MonocularCamera` ç±» | `Lidar` ç±» |
| **æ•°æ®è·å–æ–¹æ³•** | `camera.get_rgb()` | `annotator.get_data()` |
| **è¾“å‡ºæ•°æ®æ ¼å¼** | numpy array (H, W, 3) | numpy array (N, 3) |
| **é…ç½®æ–¹å¼** | ä»£ç å†…å‚æ•° | JSON é…ç½®æ–‡ä»¶ |
| **é…ç½®æ–‡ä»¶ä½ç½®** | æ— ï¼ˆä»£ç å†…ï¼‰ | `~/isaacsim/exts/.../lidar_configs/` |

## 6.2 æ•°æ®è·å–æµç¨‹å¯¹æ¯”

### ç›¸æœºæ•°æ®è·å–æµç¨‹
```python
# 1. é…ç½®ç›¸æœº
camera = MonocularCamera("front_camera", config={
    "frequency": 30.0,
    "resolution": (640, 480),
    "position": np.array([0.15, 0.0, 0.0]),
    "depth": True,
})

# 2. è·å–æ•°æ®
state = camera.state
rgb_image = state["camera"].get_rgb()  # (480, 640, 3) uint8
```

### LiDAR æ•°æ®è·å–æµç¨‹
```python
# 1. åˆ›å»º LiDAR
result, lidar_prim = omni.kit.commands.execute(
    "IsaacSensorCreateRtxLidar",
    path="/World/quadrotor/body/lidar",
    parent="/World/quadrotor/body",
    config="Example_Rotary",
    translation=(0.0, 0.0, 0.05),
    orientation=Gf.Quatd(1.0, 0.0, 0.0, 0.0)
)

# 2. åˆ›å»º Render Product å’Œ Annotator
render_product = rep.create.render_product(lidar_prim.GetPath(), [1, 1])
annotator = rep.AnnotatorRegistry.get_annotator(
    "IsaacExtractRTXSensorPointCloudNoAccumulator"
)
annotator.attach([render_product])

# 3. è·å–æ•°æ®
data = annotator.get_data()
points = np.array(data["data"]).reshape(-1, 3)  # (N, 3) float
```

---

# ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæ„ŸçŸ¥æ¬ºéª—æ³¨å…¥ç‚¹åˆ†æ

## 7.1 æ³¨å…¥ç‚¹ä½ç½®

åŸºäºæˆ‘ä»¬å¯¹æºç çš„åˆ†æï¼Œæ„ŸçŸ¥æ¬ºéª—å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ³¨å…¥ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ„ŸçŸ¥æ¬ºéª—æ³¨å…¥ç‚¹                                       â”‚
â”‚                                                                             â”‚
â”‚  Isaac Sim æ¸²æŸ“å¼•æ“                                                         â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    ä¼ æ„Ÿå™¨ API å±‚                                      â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚   camera.get_rgb()      â†’  RGB å›¾åƒ     â—„â”€â”€ ğŸ”´ æ³¨å…¥ç‚¹1: ä¿®æ”¹å›¾åƒæ•°ç»„  â”‚  â”‚
â”‚  â”‚   annotator.get_data()  â†’  ç‚¹äº‘æ•°æ®     â—„â”€â”€ ğŸ”´ æ³¨å…¥ç‚¹2: ä¿®æ”¹ç‚¹äº‘æ•°ç»„  â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    åœºæ™¯å±‚                                            â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚   DynamicCuboid(), DynamicSphere()      â—„â”€â”€ ğŸ”´ æ³¨å…¥ç‚¹3: åŠ¨æ€æ·»åŠ ç‰©ä½“ â”‚  â”‚
â”‚  â”‚   world.scene.add() / remove()                                       â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7.2 ä¸¤ç§æ¬ºéª—æ–¹å¼

| æ–¹å¼ | åŸç† | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| **æ•°æ®å±‚æ¬ºéª—** | ç›´æ¥ä¿®æ”¹ä¼ æ„Ÿå™¨è¿”å›çš„æ•°ç»„ | çµæ´»ï¼Œå¯ç²¾ç¡®æ§åˆ¶ | éœ€è¦ç†è§£æ•°æ®æ ¼å¼ |
| **åœºæ™¯å±‚æ¬ºéª—** | åœ¨è™šæ‹Ÿä¸–ç•Œä¸­æ·»åŠ /åˆ é™¤ç‰©ä½“ | æ›´çœŸå®ï¼Œå¤šä¼ æ„Ÿå™¨ä¸€è‡´ | ç‰©ç†ä»¿çœŸä¼šå—å½±å“ |

---

# ç¬¬å…«éƒ¨åˆ†ï¼šæˆ‘ä»¬å®é™…åˆ›å»ºçš„è„šæœ¬

## 8.1 ç›¸æœºæ•°æ®è·å–è„šæœ¬

**æ–‡ä»¶**ï¼š`~/test_camera_data.py`

**åŠŸèƒ½**ï¼š
- åˆ›å»ºæ— äººæœº + å‰ç½®ç›¸æœº
- æ·»åŠ æµ‹è¯•éšœç¢ç‰©ï¼ˆçº¢è‰²æ–¹å—ï¼‰
- è·å– RGB å›¾åƒå¹¶ä¿å­˜

**éªŒè¯ç»“æœ**ï¼šæˆåŠŸè·å– 640Ã—480 RGB å›¾åƒ

## 8.2 LiDAR æ•°æ®è·å–è„šæœ¬

**æ–‡ä»¶**ï¼š`~/test_lidar_data.py`

**åŠŸèƒ½**ï¼š
- åˆ›å»ºæ— äººæœº + RTX LiDAR
- æ·»åŠ æµ‹è¯•éšœç¢ç‰©
- è·å–ç‚¹äº‘æ•°æ®å¹¶ä¿å­˜
- ç”Ÿæˆä¿¯è§†å›¾å¯è§†åŒ–

**éªŒè¯ç»“æœ**ï¼šæˆåŠŸè·å– ~40,000 ä¸ªç‚¹çš„ç‚¹äº‘

---

# ç¬¬ä¹éƒ¨åˆ†ï¼šç»™å¯¼å¸ˆçš„å›ç­”æ¡†æ¶

é—®How different sensing modalities are implemented? æ—¶ï¼Œå¯ä»¥è¿™æ ·å›ç­”ï¼š

## 9.1 æ€»ä½“æ¶æ„

> "æˆ‘ä»¬çš„ä»¿çœŸå¹³å°ä½¿ç”¨ Isaac Sim 5.1.0 ä½œä¸ºåº•å±‚æ¸²æŸ“å¼•æ“ï¼Œé€šè¿‡ RTX å…‰çº¿è¿½è¸ªæŠ€æœ¯å®ç°ä¼ æ„Ÿå™¨ä»¿çœŸã€‚Pegasus Simulator 5.1.0 åœ¨æ­¤åŸºç¡€ä¸Šå°è£…äº†æ— äººæœºæ¨¡å‹å’Œä¼ æ„Ÿå™¨æ¥å£ã€‚"

## 9.2 ç›¸æœºå®ç°

> "ç›¸æœºä½¿ç”¨ `isaacsim.sensors.camera.Camera` ç±»å®ç°ï¼Œé€šè¿‡ RTX å…‰çº¿è¿½è¸ªæ¸²æŸ“ç”Ÿæˆ RGB å›¾åƒå’Œæ·±åº¦å›¾ã€‚æˆ‘ä»¬å·²ç»éªŒè¯å¯ä»¥é€šè¿‡ `get_rgb()` æ–¹æ³•è·å– 640Ã—480 çš„å›¾åƒæ•°æ®ã€‚"

## 9.3 LiDAR å®ç°

> "LiDAR ä½¿ç”¨ `IsaacSensorCreateRtxLidar` å‘½ä»¤åˆ›å»ºï¼Œæ”¯æŒå¤šç§çœŸå® LiDAR å‹å·ï¼ˆOusterã€Velodyneã€HESAI ç­‰ï¼‰ã€‚ç‚¹äº‘æ•°æ®é€šè¿‡ Replicator çš„ `IsaacExtractRTXSensorPointCloudNoAccumulator` annotator è·å–ã€‚æˆ‘ä»¬å·²éªŒè¯å¯ä»¥è·å–æ¯å¸§çº¦ 40,000 ä¸ªç‚¹çš„ç‚¹äº‘æ•°æ®ã€‚"

## 9.4 é‡åˆ°çš„é—®é¢˜

> "åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº† Isaac Sim Python 3.11 ä¸ ROS2 JAZZY Python 3.12 çš„ç‰ˆæœ¬å†²çªé—®é¢˜ï¼Œä»¥åŠ annotator åç§°åœ¨ Isaac Sim 5.1.0 ä¸­çš„å˜åŒ–ã€‚æˆ‘ä»¬é€šè¿‡ç›´æ¥ä½¿ç”¨ Isaac Sim API è€Œé ROS2 æ¥è·å–æ•°æ®ï¼Œå¹¶ä»é”™è¯¯ä¿¡æ¯ä¸­æ‰¾åˆ°äº†æ­£ç¡®çš„ annotator åç§°ã€‚"

## 9.5 æ„ŸçŸ¥æ¬ºéª—æ³¨å…¥ç‚¹

> "å¯¹äºæ„ŸçŸ¥æ¬ºéª—ç ”ç©¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸¤ä¸ªå±‚é¢æ³¨å…¥ï¼š(1) æ•°æ®å±‚â€”â€”ç›´æ¥ä¿®æ”¹ `get_rgb()` æˆ– `get_data()` è¿”å›çš„ numpy æ•°ç»„ï¼›(2) åœºæ™¯å±‚â€”â€”ä½¿ç”¨ `DynamicCuboid` ç­‰ API åŠ¨æ€æ·»åŠ è™šå‡ç‰©ä½“åˆ°åœºæ™¯ä¸­ã€‚"

---

# ç¬¬åéƒ¨åˆ†ï¼šæ–‡ä»¶æ¸…å•

## æˆ‘ä»¬åˆ›å»º/ä½¿ç”¨çš„è„šæœ¬

| æ–‡ä»¶ | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| sensor_test.py | ~/PegasusSimulator/examples/ | å¸¦ç›¸æœº+LiDARçš„åŸºç¡€ä»¿çœŸ |
| test_camera_data.py | ~/ | ç›¸æœºæ•°æ®è·å–å’Œä¿å­˜ |
| test_lidar_data.py | ~/ | LiDAR æ•°æ®è·å–å’Œå¯è§†åŒ– |
| takeoff_test.py | ~/ | æ— äººæœºèµ·é£æµ‹è¯• |

## ç”Ÿæˆçš„æ•°æ®æ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ | å†…å®¹ |
|------|------|------|
| camera_test.png | ~/ | ç›¸æœºæ‹æ‘„çš„å›¾åƒ |
| lidar_0.npy | ~/ | ç‚¹äº‘æ•°æ®ï¼ˆnumpyæ ¼å¼ï¼‰ |
| lidar_0_top.png | ~/ | ç‚¹äº‘ä¿¯è§†å›¾ |

## å…³é”®æºç ä½ç½®

| æ–‡ä»¶ | è·¯å¾„ |
|------|------|
| ç›¸æœºå®ç° | ~/PegasusSimulator/.../graphical_sensors/monocular_camera.py |
| LiDARå®ç° | ~/PegasusSimulator/.../graphical_sensors/lidar.py |
| MAVLinkåç«¯ | ~/PegasusSimulator/.../backends/px4_mavlink_backend.py |
| LiDARé…ç½® | ~/isaacsim/exts/isaacsim.sensors.rtx/data/lidar_configs/ |

---
